Project smart_maintenance_saas {
  database_type: "PostgreSQL"
  Note: 'High-level ERD source. Keep this in sync with alembic migrations.'
}

// --- Enums for Data Integrity ---
Enum task_status {
  pending
  in_progress
  completed
  failed
  cancelled
}

Enum alert_status {
  open
  acknowledged
  resolved
  ignored
}

Enum sensor_status {
  active
  inactive
  maintenance
  decommissioned
}

// --- Core Tables ---
Table sensors {
  id uuid [pk, default: `gen_random_uuid()`]
  sensor_id varchar(255) [unique, not null, note: 'The unique business ID for the sensor, e.g., TEMP-001']
  type varchar(50) [not null]
  location varchar(255) [note: 'e.g., "Factory A, Production Line 2"']
  status sensor_status [not null, default: 'active']
  created_at timestamptz [default: `now()`]
  updated_at timestamptz [default: `now()`]
}

Table sensor_readings {
  timestamp timestamptz [pk]
  sensor_id varchar(255) [pk, not null, note: 'Composite PK with timestamp']
  value float8 [not null]
  unit varchar(50)
  // Removed redundant columns like sensor_type, which are now in the `sensors` table.
}

Table anomaly_alerts {
  id uuid [pk, default: `gen_random_uuid()`]
  sensor_id varchar(255) [not null]
  anomaly_type varchar(100) [not null]
  severity int [not null, note: '1=Low, 2=Medium, 3=High, 4=Critical']
  description text
  evidence jsonb [note: 'e.g., { "violating_values": [102.5, 103.1] }']
  status alert_status [not null, default: 'open']
  created_at timestamptz [default: `now()`]
  updated_at timestamptz [default: `now()`]
}

Table maintenance_tasks {
  id uuid [pk, default: `gen_random_uuid()`]
  sensor_id varchar(255) [not null, note: 'Standardized from equipment_id']
  task_type varchar(100) [not null]
  description text
  priority int [not null, default: 3, note: '1=High, 2=Medium, 3=Low']
  status task_status [not null, default: 'pending']
  scheduled_start_time timestamptz
  created_at timestamptz [default: `now()`]
  updated_at timestamptz [default: `now()`]
}

Table maintenance_logs {
  id uuid [pk, default: `gen_random_uuid()`]
  task_id uuid [not null]
  technician_id varchar(255) [not null]
  notes text
  actual_duration_hours float8
  completion_date timestamptz [not null, default: `now()`]
  created_at timestamptz [default: `now()`]
  updated_at timestamptz [default: `now()`]
}

// --- Relationships ---
Ref: sensor_readings.sensor_id > sensors.sensor_id
Ref: anomaly_alerts.sensor_id > sensors.sensor_id
Ref: maintenance_tasks.sensor_id > sensors.sensor_id
Ref: maintenance_logs.task_id > maintenance_tasks.id